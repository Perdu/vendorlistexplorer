<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Various stats</title>
    <link rel=stylesheet type=text/css href="/static/style.css">
    <script type="text/javascript" src="/static/jquery.min.js"></script>
    <style>
      table, th {
      border: 1px solid black;
      }
    </style>
  </head>
  <body>
    {# include 'form.html' #}
    <h1>Used purposes in vendorlist {{ vendorlist_id|safe }}</h1>
    <script src="/static/Chart.js"></script>
    <canvas id="container" style="height: 800px;"></canvas>
    <script type="text/javascript">
      var canvas = document.getElementById('container');
      var ctx = canvas.getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: [
                  'Store and/or access information on a device',
                  'Select basic ads',
                  'Create a personalised ads profile',
                  'Select personalised ads',
                  'Create a personalised content profile',
                  'Select personalised content',
                  'Measure ad performance',
                  'Measure content performance',
                  'Apply market research to generate audience insights',
                  'Develop and improve product'
              ],
              datasets: [{
                  label: 'Consent',
                  data: [{{ purpose_series|safe }}],
                  borderWidth: 1
              }]
          },
          options: {
              scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero: true
                      }
                  }]
              }
          }
      });

      canvas.onclick = function(evt) {
          var activePoints = myChart.getElementsAtEvent(evt);
          if (activePoints[0]) {
              var chartData = activePoints[0]['_chart'].config.data;
              var idx = activePoints[0]['_index'];
              var purpose = idx + 1;
              $.ajax({
                  url: "vendors?vendorlistid={{ vendorlist_id }}&consentpurposeid=" + purpose,
                  type: "GET",
                  dataType : "json",
                  success: function(ans) {
                      $("#vendors_table").empty();
                      ans.forEach(function(item, index) {
                          $("#vendors_table").append($('<tr>')
                                                     .append($('<td>').append(item[0]))
                                                     .append($('<td>').append(item[1]))
                                                    );
                      }
                      );
                  },
              });

          }
      };
    </script>
    <br />
    <table id="vendors_table"></table>
    {# include 'source.html' #}
  </body>
</html>
